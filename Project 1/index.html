<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      // Load the Visualization API and the controls package.
      google.charts.load('current', {'packages':['corechart', 'controls']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawSheetName);

    //   // Callback that creates and populates a data table,
    //   // instantiates a dashboard, a range slider and a pie chart,
    //   // passes in the data and draws it.
    //   function drawDashboard() {
      //
    //     // Create our data table.
    //     var data = google.visualization.arrayToDataTable([
    //       ['Name', 'Donuts eaten'],
    //       ['Michael' , 5],
    //       ['Elisa', 7],
    //       ['Robert', 3],
    //       ['John', 2],
    //       ['Jessica', 6],
    //       ['Aaron', 1],
    //       ['Margareth', 8]
    //     ]);
      //



        // // Create a pie chart, passing some options
        // var pieChart = new google.visualization.ChartWrapper({
        //   'chartType': 'PieChart',
        //   'containerId': 'chart_div',
        //   'options': {
        //     'width': 300,
        //     'height': 300,
        //     'pieSliceText': 'value',
        //     'legend': 'right'
        //   }
        // });
      //
    //     // Establish dependencies, declaring that 'filter' drives 'pieChart',
    //     // so that the pie chart will only display entries that are let through
    //     // given the chosen slider range.
    //     dashboard.bind(donutRangeSlider, pieChart);
      //
    //     // Draw the dashboard.
    //     dashboard.draw(data);
    //   }
      //
      function drawSheetName() {
          var queryString = encodeURIComponent('SELECT A, F');

          var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1XAwhoVufdOgI3dC6Jiq0gFhZ4PN90Am1iYzDtSUQS-s/edit?usp=sharing&tq=' + queryString);

        //   var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1XWJLkAwch5GXAt_7zOFDcg8Wm8Xv29_8PWuuW15qmAE/gviz/tq?sheet=Sheet1&headers=1&tq=' + queryString);

          query.send(handleSampleDataQueryResponse);
      }

      function handleSampleDataQueryResponse(response) {
          if(response.isError()) {
              alert('Error in query' + response.getMessage() + ' ' + response.getDetailedMessage());
              return;
          }
           var data = response.getDataTable();
           console.log(data);

           // get the states from the response and put into an array.
           var states = data.getDistinctValues(1);
        //    console.log(states); // see the states array

           // get the occurences of states from the response and put into an array.
           var occurencesOfState = [];
           var totalRows = data.getNumberOfRows();
           var numberOfOccurrences = 0;
           var state;

           // for each of the states in the states array,
           for (var i=0; i < states.length; i++) {
                state = states[i];
               for(var j=0; j < totalRows; j++) {
                   // get the value of the row within the column,
                   // see if that value is equal to the value in the states array,
                   // and increment the numberOfOccurrences.
                   if(data.getValue(j,1) === state) {
                       numberOfOccurrences++;
                   }
                   // numberOfOccurrences is now set to another array
                   // in the same index of the state in the states array
                   occurencesOfState[i] = numberOfOccurrences;
               }
           }
            // Log for confirmation.
            // console.log(states);
            // console.log(occurencesOfState);

            var string_states = [];
            for(var y=0; y < states.length;y++){
                string_states[y] = states[y].toString();
            }

           // create the datatable for the piechart
           var pieChartData = new google.visualization.DataTable();
           pieChartData.addColumn('string', 'State');
           pieChartData.addColumn('number', 'Number of Toilets');

           for(var x=0;x < states.length; x++) {
               pieChartData.addRow([string_states[x], occurencesOfState[x]]);
           }

            //   Log for confirmation.
        //    console.log(pieChartData);

            var pieChartOptions = {'title' : 'Percentage of Toilets per State in Austrailia',
                                   'width' : 600,
                                   'height': 800
                               };

            var pieChart = new google.visualization.PieChart(document.getElementById('pie_chart_div'));
            pieChart.draw(pieChartData, pieChartOptions);

        //    // Create a range slider, passing some options
        //    var donutRangeSlider = new google.visualization.ControlWrapper({
        //      'controlType': 'NumberRangeFilter',
        //      'containerId': 'filter_div',
        //      'options': {
        //        'filterColumnLabel': 'Donuts eaten'
        //      }
        //    });

        //    // Create a dashboard.
        //    var dashboard = new google.visualization.Dashboard(
        //        document.getElementById('dashboard_div'));

        //    var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        //    chart.draw(data, { height: 400 });
        //
            //  dashboard.bind(donutRangeSlider, pieChart);
            //  dashboard.draw(data);
      }

    </script>
  </head>

  <body>
    <!--Div that will hold the dashboard-->
    <div id="pie_chart_div"></div>
  </body>
</html>
